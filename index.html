<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Hurricane Tobias: Florida Man Survival</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      font-family:'Courier New',monospace;
      background:linear-gradient(135deg,#87CEEB,#98FB98);
      overflow:hidden; user-select:none; touch-action:none;
    }
    #gameContainer { position:relative; width:100vw; height:100vh }
    canvas { display:block; width:100%; height:100% }
    #ui {
      position:absolute; top:10px; left:10px;
      color:#2F4F4F; font-weight:bold; z-index:10;
      text-shadow:2px 2px 4px rgba(255,255,255,0.8);
      line-height:1.4;
    }
    #startScreen,#gameOver {
      position:absolute; inset:0;
      background:rgba(0,0,0,0.8); color:white;
      display:flex; flex-direction:column;
      justify-content:center; align-items:center;
      text-align:center; z-index:20;
    }
    button {
      padding:15px 30px; font-size:1.2em;
      background:#FF6347; color:white;
      border:none; border-radius:10px;
      cursor:pointer; margin:10px;
      transition:0.3s;
    }
    button:hover { background:#FF4500; transform:scale(1.05) }
    #levelIndicator {
      position:absolute; inset:0;
      display:flex; justify-content:center; align-items:center;
      font-size:4em; color:#FFD700;
      text-shadow:3px 3px 6px rgba(0,0,0,0.8);
      opacity:0; pointer-events:none;
      transition:opacity 0.5s; z-index:15;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
    <div id="ui">
      Score: <span id="score">0</span><br>
      Level: <span id="level">1</span><br>
      Lives: <span id="lives">3</span><br>
      Sudafed: <span id="sudafed">0</span>
    </div>
    <div id="levelIndicator"></div>
    <div id="startScreen">
      <h1>🌪️ HURRICANE TOBIAS 🌪️</h1>
      <h2>Florida Man Survival Game</h2>
      <p>🎯 Drag or tap to move Tobias — collect 🐊 🐔 💊, avoid 🐕 🐝</p>
      <button onclick="startGame()">START GAME</button>
    </div>
    <div id="gameOver" style="display:none;">
      <h1>GAME OVER</h1>
      <p id="finalScore"></p>
      <p id="gameOverMessage"></p>
      <button onclick="restartGame()">PLAY AGAIN</button>
    </div>
  </div>

  <script>
  let canvas, ctx, game;

  const ENTITY_TYPES = [
    { type:'alligator', emoji:'🐊', baseWeight:3, speed:2, collectible:true,   score:100 },
    { type:'chicken',   emoji:'🐔', baseWeight:2, speed:2, collectible:true,   score:60  },
    { type:'sudafed',    emoji:'💊', baseWeight:1, speed:2, collectible:true,   score: 0, isSudafed:true },
    { type:'dog',        emoji:'🐕', baseWeight:2, speed:2.5, collectible:false, damage:true },
    { type:'bee',        emoji:'🐝', baseWeight:1, speed:4,   collectible:false, damage:true }
  ];

  function init(){
    canvas = document.getElementById('gameCanvas');
    ctx    = canvas.getContext('2d');
    window.addEventListener('resize', resize);
    resize();
    resetGame();
    setupControls();
  }

  function resize(){
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;
    if(game) game.player.y = canvas.height - 100;
  }

  function resetGame(){
    game = {
      score:0, level:1, lives:3, sudafed:0,
      player:{ x:canvas.width/2 -30, y:canvas.height-100, w:60, h:60 },
      entities: [],
      running: false
    };
  }

  function setupControls(){
    // pointer: tap or drag to move
    canvas.addEventListener('pointerdown', movePlayer);
    canvas.addEventListener('pointermove', movePlayer);
  }

  function movePlayer(e){
    const r = canvas.getBoundingClientRect();
    const x = e.clientX - r.left - game.player.w/2;
    game.player.x = Math.max(0, Math.min(canvas.width - game.player.w, x));
  }

  function startGame(){
    document.getElementById('startScreen').style.display='none';
    resetGame();
    game.running = true;
    showLevelIndicator();
    spawnLoop();
    requestAnimationFrame(gameLoop);
  }

  function restartGame(){
    document.getElementById('gameOver').style.display='none';
    startGame();
  }

  function showLevelIndicator(){
    const el = document.getElementById('levelIndicator');
    el.textContent = `Level ${game.level}`;
    el.style.opacity = 1;
    setTimeout(()=>el.style.opacity = 0, 2000);
  }

  function spawnLoop(){
    if(!game.running) return;
    spawnEntity();
    const interval = Math.max(500, 2000 - game.level * 100);
    setTimeout(spawnLoop, interval);
  }

  function spawnEntity(){
    // build weighted list
    const weights = ENTITY_TYPES.map(ent=>{
      // hazards ramp up with level
      const factor = ent.damage ? (1 + game.level * 0.2) : 1;
      return ent.baseWeight * factor;
    });
    const total = weights.reduce((a,b)=>a+b,0);
    let r = Math.random() * total;
    let idx = 0;
    while(r > weights[idx]){ r -= weights[idx]; idx++ }
    const proto = ENTITY_TYPES[idx];

    // create instance
    const e = {
      ...proto,
      x: Math.random() * (canvas.width - 40),
      y:-40,
      w:40, h:40,
      vy: proto.speed
    };
    // bees can drift sideways
    if(e.type==='bee') e.vx = (Math.random()-0.5) * 2;
    else e.vx = 0;

    game.entities.push(e);
  }

  function gameLoop(){
    if(!game.running) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // move & draw player
    ctx.font='50px Arial'; ctx.textAlign='center';
    ctx.fillText('🤠', game.player.x +30, game.player.y+60);

    // update entities
    game.entities = game.entities.filter(e=>{
      e.x += e.vx; e.y += e.vy;
      // remove off-screen
      if(e.y > canvas.height) return false;

      // draw
      ctx.font=(e.isSudafed?'30px':'35px')+' Arial';
      ctx.fillText(e.emoji, e.x + e.w/2, e.y + e.h);

      // collision?
      const px = game.player.x, py = game.player.y, pw = game.player.w, ph = game.player.h;
      if(e.x < px+pw && e.x+e.w > px && e.y < py+ph && e.y+e.h > py){
        if(e.collectible){
          if(e.isSudafed) game.sudafed++;
          else game.score += e.score;
        } else if(e.damage){
          game.lives--;
        }
        return false; // remove on collide
      }
      return true;
    });

    updateUI();
    checkLevelUp();
    checkGameOver();

    requestAnimationFrame(gameLoop);
  }

  function updateUI(){
    document.getElementById('score').textContent  = game.score;
    document.getElementById('level').textContent  = game.level;
    document.getElementById('lives').textContent  = game.lives;
    document.getElementById('sudafed').textContent = game.sudafed;
  }

  function checkLevelUp(){
    if(game.score >= game.level * 500){
      game.level++;
      showLevelIndicator();
    }
  }

  function checkGameOver(){
    if(game.lives <= 0){
      game.running = false;
      document.getElementById('finalScore').textContent = `Final Score: ${game.score}`;
      const msgs = [
        "Even Hurricane Tobias needs a break!",
        "Those bees were too fast!",
        "Watch out for those dogs!",
        "Time for more Sudafed!",
        "Oops—be more careful next time!"
      ];
      document.getElementById('gameOverMessage')
        .textContent = msgs[Math.floor(Math.random()*msgs.length)];
      document.getElementById('gameOver').style.display = 'flex';
    }
  }

  window.addEventListener('load', init);
  </script>
</body>
</html>
